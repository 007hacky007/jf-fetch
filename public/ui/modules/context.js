/**
 * Shared UI context objects: global state, DOM references, API endpoints, and static catalog data.
 */

export const state = {
	user: null,
	providers: [],
	users: [],
	searchResults: [],
	selectedSearch: new Set(),
	jobs: [],
	showMyJobs: false,
	storage: [],
	storageUpdatedAt: null,
	jobStream: null,
	isAdmin: false,
	isQueueSubmitting: false,
	usersLoading: false,
	storageIntervalId: null,
	jobNotifications: new Set(),
	auditLogs: [],
	auditCursor: null,
	auditLoading: false,
	settings: null,
	settingsLoading: false,
	settingsSaving: false,
	settingsError: null,
	jobStreamConnectedAt: null, // timestamp (ms) when current SSE connection opened
	defaultSearchLimit: 50,
	// Paging metadata for jobs list (server-side infinite scroll)
	jobsPageSize: 10,
	jobsOffset: 0,
	jobsTotal: null,
	jobsHasMore: true,
	jobsLoadingPage: false,
};

export const els = {
	app: document.getElementById('app'),
	loginView: document.getElementById('login-view'),
	loginForm: document.getElementById('login-form'),
	loginEmail: document.getElementById('login-email'),
	loginPassword: document.getElementById('login-password'),
	loginError: document.getElementById('login-error'),
	dashboardView: document.getElementById('dashboard-view'),
	logoutBtn: document.getElementById('logout-btn'),
	userPill: document.getElementById('user-pill'),
	tabs: Array.from(document.querySelectorAll('#view-tabs [data-view]')),
	panels: Array.from(document.querySelectorAll('[data-panel]')),
	providersTab: document.getElementById('providers-tab'),
	usersTab: document.getElementById('users-tab'),
	auditTab: document.getElementById('audit-tab'),
	searchForm: document.getElementById('search-form'),
	searchQuery: document.getElementById('search-query'),
	searchLimit: document.getElementById('search-limit'),
	providerFilters: document.getElementById('provider-filters'),
	queueSelectionBtn: document.getElementById('queue-selection-btn'),
	searchResults: document.getElementById('search-results'),
	searchMeta: document.getElementById('search-meta'),
	searchWarnings: document.getElementById('search-warnings'),
	searchEmpty: document.getElementById('search-empty'),
	searchLoading: document.getElementById('search-loading'),
	searchErrors: document.getElementById('search-errors'),
	jobsList: document.getElementById('jobs-list'),
	jobsEmpty: document.getElementById('jobs-empty'),
	jobsSummary: document.getElementById('jobs-summary'),
	jobsLoading: document.getElementById('jobs-loading'),
	jobsMineToggle: document.getElementById('jobs-mine-toggle'),
	providersList: document.getElementById('providers-list'),
	providersEmpty: document.getElementById('providers-empty'),
	providersError: document.getElementById('providers-error'),
	providersStatusWrapper: document.getElementById('providers-status-wrapper'),
	providersStatusList: document.getElementById('providers-status-list'),
	providersStatusLoading: document.getElementById('providers-status-loading'),
	providersStatusError: document.getElementById('providers-status-error'),
	providersStatusMeta: document.getElementById('providers-status-meta'),
	providerCreateBtn: document.getElementById('provider-create-btn'),
	settingsTab: document.getElementById('settings-tab'),
	settingsView: document.getElementById('settings-view'),
	settingsForm: document.getElementById('settings-form'),
	settingsError: document.getElementById('settings-error'),
	settingsLoading: document.getElementById('settings-loading'),
	settingsSaveBtn: document.getElementById('settings-save-btn'),
	settingsBaseUrl: document.getElementById('settings-base-url'),
	settingsMaxDownloads: document.getElementById('settings-max-downloads'),
	settingsMinFreeSpace: document.getElementById('settings-min-free-space'),
	settingsDefaultSearchLimit: document.getElementById('settings-default-search-limit'),
	settingsDownloadsPath: document.getElementById('settings-downloads-path'),
	settingsLibraryPath: document.getElementById('settings-library-path'),
	settingsJellyfinUrl: document.getElementById('settings-jellyfin-url'),
	settingsJellyfinApiKey: document.getElementById('settings-jellyfin-api-key'),
	settingsJellyfinLibraryId: document.getElementById('settings-jellyfin-library-id'),
	jellyfinLibrariesSelect: document.getElementById('jellyfin-libraries-select'),
	usersTable: document.getElementById('users-table'),
	usersEmpty: document.getElementById('users-empty'),
	usersError: document.getElementById('users-error'),
	userCreateBtn: document.getElementById('user-create-btn'),
	storageMounts: document.getElementById('storage-mounts'),
	storageLoading: document.getElementById('storage-loading'),
	storageError: document.getElementById('storage-error'),
	storageRefreshBtn: document.getElementById('storage-refresh-btn'),
	auditTable: document.getElementById('audit-table'),
	auditEmpty: document.getElementById('audit-empty'),
	auditError: document.getElementById('audit-error'),
	auditLoadMore: document.getElementById('audit-load-more'),
	auditLoading: document.getElementById('audit-loading'),
	auditRefreshBtn: document.getElementById('audit-refresh-btn'),
	toastContainer: document.getElementById('toast-container'),
	modal: document.getElementById('modal'),
};

export const API = {
	login: '/api/auth/login',
	logout: '/api/auth/logout',
	session: '/api/auth/session',
	providers: '/api/providers/list',
	providerCreate: '/api/providers/create',
	providerUpdate: '/api/providers/update',
	providerDelete: '/api/providers/delete',
	providerTest: '/api/providers/test',
	providersStatusAll: '/api/providers/status_all',
	search: '/api/search',
	queue: '/api/jobs/queue',
	jobsList: '/api/jobs/list',
	jobCancel: '/api/jobs/cancel',
	jobPause: '/api/jobs/pause',
	jobResume: '/api/jobs/resume',
	jobRetry: '/api/jobs/retry',
	jobPriority: '/api/jobs/priority',
	jobReorder: '/api/jobs/reorder',
	jobDelete: '/api/jobs/delete',
	jobDownload: '/api/jobs/download',
	jobStream: '/api/jobs/stream',
	jobsStats: '/api/jobs/stats',
	systemStorage: '/api/system/storage',
	systemHealth: '/api/system/health',
	users: '/api/users',
	audit: '/api/audit',
	settings: '/api/settings',
	jellyfinLibraries: '/api/system/jellyfin_libraries',
};

export const providerCatalog = {
	webshare: {
		key: 'webshare',
		label: 'Webshare',
		description: 'Enter your Webshare credentials. JF Fetch will request and store the API token for you.',
		defaultName: 'Webshare',
		fields: [
			{
				name: 'username',
				label: 'Webshare username (or email)',
				placeholder: 'your-email@example.com',
				required: true,
				type: 'text',
				help: 'Use the same username or email you sign in with on webshare.cz.',
			},
			{
				name: 'password',
				label: 'Webshare password',
				placeholder: 'Enter your Webshare password',
				required: true,
				type: 'password',
				help: 'The password is encrypted at rest. A fresh token is fetched automatically.',
			},
		],
	},
	kraska: {
		key: 'kraska',
		label: 'Kra.sk',
		description: 'Configure your Kra.sk credentials powering Stream-Cinema searches & downloads.',
		defaultName: 'Kra.sk',
		fields: [
			{
				name: 'username',
				label: 'Kra.sk username',
				placeholder: 'your-user',
				required: true,
				type: 'text',
				help: 'Your Kra.sk account username (not email, if distinct).',
			},
			{
				name: 'password',
				label: 'Kra.sk password',
				placeholder: '••••••••',
				required: true,
				type: 'password',
				help: 'Stored encrypted. Session + Stream-Cinema token derived automatically.',
			},
			{
				name: 'uuid',
				label: 'Static X-Uuid (optional)',
				placeholder: 'xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx',
				required: false,
				type: 'text',
				help: 'If provided, used as X-Uuid header for Stream-Cinema requests; leave blank to auto-generate.',
			},
			{
				name: 'ident_rate_limit_seconds',
				label: 'Ident fetch rate limit (seconds)',
				placeholder: '120',
				required: false,
				type: 'number',
				attributes: { min: 1, step: 1 },
				help: 'Minimum seconds between Stream-Cinema detail requests. Leave blank to use the default (120).',
			},
		],
	},
};

export const JOB_STREAM_EVENTS = ['job.updated', 'job.completed', 'job.failed', 'job.removed', 'job.deleted'];
