/**
 * Shared UI context objects: global state, DOM references, API endpoints, and static catalog data.
 */

export const state = {
	user: null,
	providers: [],
	users: [],
	searchResults: [],
	selectedSearch: new Set(),
	jobs: [],
	showMyJobs: false,
	storage: [],
	storageUpdatedAt: null,
	jobStream: null,
	activity: [],
	isAdmin: false,
	isQueueSubmitting: false,
	usersLoading: false,
	storageIntervalId: null,
	jobNotifications: new Set(),
	auditLogs: [],
	auditCursor: null,
	auditLoading: false,
	settings: null,
	settingsLoading: false,
	settingsSaving: false,
	settingsError: null,
	jobStreamConnectedAt: null, // timestamp (ms) when current SSE connection opened
};

export const els = {
	app: document.getElementById('app'),
	loginView: document.getElementById('login-view'),
	loginForm: document.getElementById('login-form'),
	loginEmail: document.getElementById('login-email'),
	loginPassword: document.getElementById('login-password'),
	loginError: document.getElementById('login-error'),
	dashboardView: document.getElementById('dashboard-view'),
	logoutBtn: document.getElementById('logout-btn'),
	userPill: document.getElementById('user-pill'),
	tabs: Array.from(document.querySelectorAll('#view-tabs [data-view]')),
	panels: Array.from(document.querySelectorAll('[data-panel]')),
	providersTab: document.getElementById('providers-tab'),
	usersTab: document.getElementById('users-tab'),
	auditTab: document.getElementById('audit-tab'),
	searchForm: document.getElementById('search-form'),
	searchQuery: document.getElementById('search-query'),
	searchLimit: document.getElementById('search-limit'),
	providerFilters: document.getElementById('provider-filters'),
	queueSelectionBtn: document.getElementById('queue-selection-btn'),
	searchResults: document.getElementById('search-results'),
	searchMeta: document.getElementById('search-meta'),
	searchEmpty: document.getElementById('search-empty'),
	searchLoading: document.getElementById('search-loading'),
	searchErrors: document.getElementById('search-errors'),
	jobsList: document.getElementById('jobs-list'),
	jobsEmpty: document.getElementById('jobs-empty'),
	jobsSummary: document.getElementById('jobs-summary'),
	jobsLoading: document.getElementById('jobs-loading'),
	jobsMineToggle: document.getElementById('jobs-mine-toggle'),
	providersList: document.getElementById('providers-list'),
	providersEmpty: document.getElementById('providers-empty'),
	providersError: document.getElementById('providers-error'),
	providerCreateBtn: document.getElementById('provider-create-btn'),
	settingsTab: document.getElementById('settings-tab'),
	settingsView: document.getElementById('settings-view'),
	settingsForm: document.getElementById('settings-form'),
	settingsError: document.getElementById('settings-error'),
	settingsLoading: document.getElementById('settings-loading'),
	settingsSaveBtn: document.getElementById('settings-save-btn'),
	settingsBaseUrl: document.getElementById('settings-base-url'),
	settingsMaxDownloads: document.getElementById('settings-max-downloads'),
	settingsMinFreeSpace: document.getElementById('settings-min-free-space'),
	settingsDownloadsPath: document.getElementById('settings-downloads-path'),
	settingsLibraryPath: document.getElementById('settings-library-path'),
	settingsJellyfinUrl: document.getElementById('settings-jellyfin-url'),
	settingsJellyfinApiKey: document.getElementById('settings-jellyfin-api-key'),
	usersTable: document.getElementById('users-table'),
	usersEmpty: document.getElementById('users-empty'),
	usersError: document.getElementById('users-error'),
	userCreateBtn: document.getElementById('user-create-btn'),
	storageMounts: document.getElementById('storage-mounts'),
	storageLoading: document.getElementById('storage-loading'),
	storageError: document.getElementById('storage-error'),
	storageRefreshBtn: document.getElementById('storage-refresh-btn'),
	activityFeed: document.getElementById('activity-feed'),
	activityEmpty: document.getElementById('activity-empty'),
	activityClearBtn: document.getElementById('activity-clear-btn'),
	auditTable: document.getElementById('audit-table'),
	auditEmpty: document.getElementById('audit-empty'),
	auditError: document.getElementById('audit-error'),
	auditLoadMore: document.getElementById('audit-load-more'),
	auditLoading: document.getElementById('audit-loading'),
	auditRefreshBtn: document.getElementById('audit-refresh-btn'),
	toastContainer: document.getElementById('toast-container'),
	modal: document.getElementById('modal'),
};

export const API = {
	login: '/api/auth/login',
	logout: '/api/auth/logout',
	session: '/api/auth/session',
	providers: '/api/providers/list',
	providerCreate: '/api/providers/create',
	providerUpdate: '/api/providers/update',
	providerDelete: '/api/providers/delete',
	providerTest: '/api/providers/test',
	search: '/api/search',
	queue: '/api/jobs/queue',
	jobsList: '/api/jobs/list',
	jobCancel: '/api/jobs/cancel',
	jobPause: '/api/jobs/pause',
	jobResume: '/api/jobs/resume',
	jobPriority: '/api/jobs/priority',
	jobReorder: '/api/jobs/reorder',
	jobDelete: '/api/jobs/delete',
	jobStream: '/api/jobs/stream',
	systemStorage: '/api/system/storage',
	systemHealth: '/api/system/health',
	users: '/api/users',
	audit: '/api/audit',
	settings: '/api/settings',
};

export const providerCatalog = {
	webshare: {
		key: 'webshare',
		label: 'Webshare',
		description: 'Enter your Webshare credentials. JF Fetch will request and store the API token for you.',
		defaultName: 'Webshare',
		fields: [
			{
				name: 'username',
				label: 'Webshare username (or email)',
				placeholder: 'your-email@example.com',
				required: true,
				type: 'text',
				help: 'Use the same username or email you sign in with on webshare.cz.',
			},
			{
				name: 'password',
				label: 'Webshare password',
				placeholder: 'Enter your Webshare password',
				required: true,
				type: 'password',
				help: 'The password is encrypted at rest. A fresh token is fetched automatically.',
			},
		],
	},
};

export const JOB_STREAM_EVENTS = ['job.updated', 'job.completed', 'job.failed', 'job.removed', 'job.deleted'];
