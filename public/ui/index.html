<!DOCTYPE html>
<html lang="en" class="h-full">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>JF Fetch</title>
    <script>
      window.tailwind = {
        theme: {
          extend: {
            colors: {
              brand: {
                50: '#f3f8ff',
                100: '#e0edff',
                200: '#bbd7ff',
                300: '#8bb8ff',
                400: '#4f8cff',
                500: '#1f60ff',
                600: '#1248db',
                700: '#0d36a8',
                800: '#092676',
                900: '#051b51'
              }
            }
          }
        }
      };
    </script>
    <script src="https://cdn.tailwindcss.com?plugins=forms,typography,aspect-ratio,line-clamp"></script>
  <link rel="stylesheet" href="/ui/styles.css?v=__APP_ASSET_VERSION__" />
  <script>window.APP_BUILD_VERSION = '__APP_ASSET_VERSION__';</script>
  <script type="module" src="/ui/app.js?v=__APP_ASSET_VERSION__" defer></script>
  </head>
  <body class="h-full bg-slate-950 text-slate-100">
    <div id="app" class="mx-auto flex min-h-screen w-full max-w-7xl flex-col px-4 pb-16 pt-8 sm:px-8">
      <div id="asset-version-banner" class="hidden mb-4 items-center justify-between rounded-2xl border border-amber-500/40 bg-amber-500/15 px-4 py-3 text-sm text-amber-100">
        <span data-version-message>New interface update available.</span>
        <button id="asset-version-reload" type="button" class="rounded-lg border border-amber-300/60 bg-amber-400/20 px-3 py-1 text-xs font-semibold text-amber-50 transition hover:border-amber-200/70 hover:bg-amber-300/30">Reload now</button>
      </div>
      <div id="global-warning-banner" class="hidden mb-4 flex flex-col gap-3 rounded-2xl border border-amber-500/40 bg-amber-500/15 px-4 py-3 text-sm text-amber-100"></div>
      <header class="flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between">
        <div>
          <h1 class="text-3xl font-semibold tracking-tight">JF Fetch</h1>
          <p class="text-sm text-slate-400">Search, download, and import videos with Jellyfin automation.</p>
        </div>
        <div class="flex items-center gap-3">
          <div id="user-pill" class="hidden items-center gap-3 rounded-full border border-slate-800/80 bg-slate-900/60 px-4 py-2 text-sm shadow-sm"></div>
          <button id="logout-btn" class="hidden rounded-full bg-red-500 px-4 py-2 text-sm font-medium text-white shadow-sm transition hover:bg-red-400 focus:outline-none focus:ring focus:ring-red-500/40">Sign out</button>
        </div>
      </header>

      <section id="login-view" class="mt-10 w-full max-w-md self-center rounded-2xl border border-slate-800/80 bg-slate-900/80 p-8 shadow-xl">
        <div class="mb-6 text-center">
          <h2 class="text-xl font-semibold">Welcome back</h2>
          <p class="mt-1 text-sm text-slate-400">Sign in to manage downloads and your Jellyfin library.</p>
        </div>
  <form id="login-form" class="space-y-4">
          <div>
            <label for="login-email" class="block text-sm font-medium text-slate-200">Email</label>
            <input id="login-email" name="email" type="email" autocomplete="email" placeholder="admin@example.com" required class="mt-1 w-full rounded-lg border border-slate-800 bg-slate-950/70 px-3 py-2 text-base text-slate-100 placeholder-slate-500 focus:border-brand-400 focus:outline-none focus:ring focus:ring-brand-500/40" />
          </div>
          <div>
            <label for="login-password" class="block text-sm font-medium text-slate-200">Password</label>
            <input id="login-password" name="password" type="password" autocomplete="current-password" required class="mt-1 w-full rounded-lg border border-slate-800 bg-slate-950/70 px-3 py-2 text-base text-slate-100 placeholder-slate-500 focus:border-brand-400 focus:outline-none focus:ring focus:ring-brand-500/40" />
          </div>
          <button type="submit" class="w-full rounded-lg bg-brand-500 px-4 py-2 text-base font-semibold text-white shadow transition hover:bg-brand-400 focus:outline-none focus:ring focus:ring-brand-500/40">Sign in</button>
          <p id="login-error" class="hidden text-sm text-red-400"></p>
        </form>
      </section>

      <section id="dashboard-view" class="mt-8 hidden flex-1">
        <div class="grid w-full gap-6 lg:grid-cols-[2fr_1fr]">
          <div class="space-y-6">
            <nav id="view-tabs" class="flex flex-wrap gap-2 rounded-2xl border border-slate-800/80 bg-slate-900/70 p-2">
              <button type="button" data-view="search" class="tab-button">Search</button>
              <button type="button" id="kraska-tab" data-view="kraska" class="tab-button">Browse</button>
              <button type="button" data-view="queue" class="tab-button">Queue</button>
              <button type="button" id="providers-tab" data-view="providers" class="tab-button hidden">Providers</button>
              <button type="button" id="settings-tab" data-view="settings" class="tab-button hidden">Settings</button>
              <button type="button" id="users-tab" data-view="users" class="tab-button hidden">Users</button>
              <button type="button" id="audit-tab" data-view="audit" class="tab-button hidden">Audit Log</button>
            </nav>

            <section id="search-view" data-panel="search" class="panel hidden">
              <div class="flex flex-col gap-6">
                <form id="search-form" class="space-y-4 rounded-2xl border border-slate-800/70 bg-slate-900/60 p-6 shadow">
                  <div class="flex flex-col gap-3 sm:flex-row sm:items-end">
                    <div class="flex-1">
                      <label for="search-query" class="block text-sm font-medium text-slate-200">Search query</label>
                      <input id="search-query" name="query" type="text" placeholder="e.g. The Matrix 1999" required class="mt-1 w-full rounded-lg border border-slate-800 bg-slate-950/70 px-3 py-2 text-base text-slate-100 placeholder-slate-500 focus:border-brand-400 focus:outline-none focus:ring focus:ring-brand-500/40" />
                    </div>
                    <div class="w-full max-w-[120px]">
                      <label for="search-limit" class="block text-sm font-medium text-slate-200">Limit</label>
                      <input id="search-limit" name="limit" type="number" min="1" max="100" value="50" class="mt-1 w-full rounded-lg border border-slate-800 bg-slate-950/70 px-3 py-2 text-base text-slate-100 focus:border-brand-400 focus:outline-none focus:ring focus:ring-brand-500/40" />
                    </div>
                    <button type="submit" class="inline-flex items-center justify-center rounded-lg bg-brand-500 px-4 py-2 text-sm font-semibold text-white shadow transition hover:bg-brand-400 focus:outline-none focus:ring focus:ring-brand-500/40">Search</button>
                  </div>
                  <div id="provider-filters" class="flex flex-wrap gap-3 text-sm text-slate-300"></div>
                </form>
                <div class="rounded-2xl border border-slate-800/70 bg-slate-900/60 p-6 shadow">
                  <div class="mb-4 flex items-center justify-between">
                    <h3 class="text-lg font-semibold text-slate-100">Results</h3>
                    <button id="queue-selection-btn" type="button" class="hidden rounded-lg bg-emerald-500 px-4 py-2 text-sm font-semibold text-white shadow transition hover:bg-emerald-400 focus:outline-none focus:ring focus:ring-emerald-500/40">Add selected to queue</button>
                  </div>
                  <div id="search-meta" class="mb-4 text-sm text-slate-400"></div>
                  <div id="search-warnings" class="hidden mb-4 rounded-lg border border-amber-500/40 bg-amber-500/10 px-4 py-3 text-sm text-amber-200"></div>
                  <ul id="search-results" class="flex flex-col gap-3"></ul>
                  <div id="search-empty" class="hidden text-sm text-slate-500">Search for something to see results here.</div>
                  <div id="search-loading" class="hidden text-sm text-brand-300">Searching providers…</div>
                  <div id="search-errors" class="hidden space-y-2"></div>
                </div>
              </div>
            </section>

            <section id="kraska-view" data-panel="kraska" class="panel hidden">
              <div class="rounded-2xl border border-slate-800/70 bg-slate-900/60 p-6 shadow">
                <div class="mb-4 flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between">
                  <div>
                    <h3 class="text-lg font-semibold text-slate-100">Browse Stream-Cinema</h3>
                    <p class="text-sm text-slate-400">Navigate Kra.sk menus and queue playable items.</p>
                  </div>
                  <div class="flex flex-wrap items-center gap-2">
                    <button id="kraska-home-btn" type="button" class="rounded-lg border border-slate-700/60 bg-slate-950/60 px-3 py-1.5 text-xs font-semibold text-slate-200 transition hover:border-brand-400/60 hover:text-brand-200">Home</button>
                    <button id="kraska-back-btn" type="button" class="rounded-lg border border-slate-700/60 bg-slate-950/60 px-3 py-1.5 text-xs font-semibold text-slate-200 transition hover:border-brand-400/60 hover:text-brand-200 disabled:opacity-40" disabled>Back</button>
                    <button id="kraska-queue-btn" type="button" class="hidden rounded-lg bg-emerald-500 px-4 py-2 text-xs font-semibold text-white shadow transition hover:bg-emerald-400 focus:outline-none focus:ring focus:ring-emerald-500/40">Add selected to queue</button>
                    <button id="kraska-refresh-btn" type="button" class="rounded-lg border border-slate-700/60 bg-slate-950/60 px-3 py-1.5 text-xs font-semibold text-slate-200 transition hover:border-brand-400/60 hover:text-brand-200">Refresh from source</button>
                    <label class="inline-flex items-center gap-2 rounded-lg border border-slate-700/60 bg-slate-950/60 px-3 py-1.5 text-xs font-semibold text-slate-200 transition hover:border-brand-400/60 hover:text-brand-200">
                      <input id="kraska-select-all" type="checkbox" class="h-4 w-4 rounded border-slate-600 bg-slate-800 text-brand-500 focus:ring-brand-500/60" />
                      Select all on this level
                    </label>
                  </div>
                </div>
                <div id="kraska-cache-meta" class="hidden rounded-full border border-slate-800/60 bg-slate-900/60 px-3 py-1 text-xs text-slate-300"></div>
                <div id="kraska-breadcrumbs" class="mb-3 flex flex-wrap items-center gap-2 text-sm text-slate-400"></div>
                <div id="kraska-error" class="hidden mb-3 rounded-lg border border-rose-500/40 bg-rose-500/10 p-3 text-sm text-rose-200"></div>
                <div id="kraska-loading" class="hidden text-sm text-brand-300">Loading menu…</div>
                <div id="kraska-empty" class="hidden text-sm text-slate-500">No items available here.</div>
                <ul id="kraska-list" class="flex flex-col gap-3"></ul>
              </div>
            </section>

            <section id="queue-view" data-panel="queue" class="panel hidden">
              <div class="rounded-2xl border border-slate-800/70 bg-slate-900/60 p-6 shadow">
                <div class="mb-4 flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between">
                  <div>
                    <h3 class="text-lg font-semibold text-slate-100">Job queue</h3>
                    <p class="text-sm text-slate-400">Monitor progress, pause/resume, cancel, and reorder downloads.</p>
                  </div>
                  <div class="flex flex-col gap-2 sm:flex-row sm:items-center">
                    <div class="flex flex-wrap items-center gap-2">
                      <button id="retry-failed-4h-btn" type="button" class="rounded-lg border border-amber-600/60 bg-amber-500/10 px-3 py-1.5 text-xs font-semibold text-amber-300 transition hover:border-amber-500/80 hover:bg-amber-500/20 focus:outline-none focus:ring focus:ring-amber-500/40">Retry failed (4h)</button>
                      <button id="retry-failed-24h-btn" type="button" class="rounded-lg border border-amber-600/60 bg-amber-500/10 px-3 py-1.5 text-xs font-semibold text-amber-300 transition hover:border-amber-500/80 hover:bg-amber-500/20 focus:outline-none focus:ring focus:ring-amber-500/40">Retry failed (24h)</button>
                      <button id="cancel-all-queued-btn" type="button" class="rounded-lg border border-rose-600/60 bg-rose-500/10 px-3 py-1.5 text-xs font-semibold text-rose-200 transition hover:border-rose-500/80 hover:bg-rose-500/20 focus:outline-none focus:ring focus:ring-rose-500/40">Cancel all queued</button>
                    </div>
                    <label class="inline-flex items-center gap-2 text-sm text-slate-300">
                      <input id="jobs-mine-toggle" type="checkbox" class="rounded border-slate-600 bg-slate-800 text-brand-500 focus:ring-brand-500/60" />
                      Show only my jobs
                    </label>
                  </div>
                </div>
                <div id="jobs-summary" class="mb-4 text-sm text-slate-400"></div>
                <div id="jobs-empty" class="hidden rounded-xl border border-dashed border-slate-700/60 p-8 text-center text-sm text-slate-400">No jobs yet. Queue something from the Search tab.</div>
                <ul id="jobs-list" class="flex flex-col gap-3"></ul>
                <div id="jobs-loading" class="hidden text-sm text-brand-300">Loading jobs…</div>
              </div>
            </section>

            <section id="providers-view" data-panel="providers" class="panel hidden">
              <div class="rounded-2xl border border-slate-800/70 bg-slate-900/60 p-6 shadow">
                <div class="mb-4 flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between">
                  <div>
                    <h3 class="text-lg font-semibold text-slate-100">Providers</h3>
                    <p class="text-sm text-slate-400">Manage provider credentials and availability.</p>
                  </div>
                  <button id="provider-create-btn" type="button" class="rounded-lg bg-brand-500 px-4 py-2 text-sm font-semibold text-white shadow transition hover:bg-brand-400 focus:outline-none focus:ring focus:ring-brand-500/40">Add provider</button>
                </div>
                <div id="providers-empty" class="hidden rounded-xl border border-dashed border-slate-700/60 p-8 text-center text-sm text-slate-400">No providers configured yet.</div>
                <div id="providers-error" class="hidden rounded-xl border border-rose-500/40 bg-rose-500/10 p-4 text-sm text-rose-200"></div>
                <div id="providers-status-wrapper" class="mb-6 hidden">
                  <div class="rounded-xl border border-slate-800/70 bg-slate-950/40 p-4">
                    <div class="mb-3 flex items-center justify-between">
                      <h4 class="text-sm font-semibold uppercase tracking-wide text-slate-300">Status (24h cache)</h4>
                      <button id="providers-status-refresh" type="button" class="rounded-md border border-slate-700/60 bg-slate-900/60 px-2 py-1 text-xs font-medium text-slate-300 hover:border-brand-400/60 hover:text-brand-200">Force refresh</button>
                    </div>
                    <div id="providers-status-loading" class="hidden text-xs text-brand-300">Loading provider statuses…</div>
                    <div id="providers-status-error" class="hidden rounded-lg border border-rose-500/40 bg-rose-500/10 p-2 text-xs text-rose-200"></div>
                    <ul id="providers-status-list" class="flex flex-col gap-2 text-xs"></ul>
                    <div id="providers-status-meta" class="mt-2 text-[10px] uppercase tracking-wide text-slate-500"></div>
                  </div>
                </div>
                <ul id="providers-list" class="flex flex-col gap-4"></ul>
              </div>
            </section>

            <section id="audit-view" data-panel="audit" class="panel hidden">
              <div class="space-y-6">
                <div class="rounded-2xl border border-slate-800/70 bg-slate-900/60 p-6 shadow">
                  <div class="mb-4 flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between">
                    <div>
                      <h3 class="text-lg font-semibold text-slate-100">Audit Log & System Health</h3>
                      <p class="text-sm text-slate-400">Review recent actions, check aria2 status, and inspect daemon logs.</p>
                    </div>
                    <div class="flex flex-wrap items-center gap-2">
                      <button id="audit-refresh-btn" type="button" class="rounded-lg border border-slate-700/60 bg-slate-950/60 px-3 py-1.5 text-xs font-semibold text-slate-200 transition hover:border-brand-400/60 hover:text-brand-200">Refresh audit</button>
                      <button id="audit-load-more" type="button" class="rounded-lg border border-slate-700/60 bg-slate-950/60 px-3 py-1.5 text-xs font-semibold text-slate-200 transition hover:border-brand-400/60 hover:text-brand-200">Load older</button>
                      <button id="aria2-health-btn" type="button" class="rounded-lg border border-emerald-600/60 bg-emerald-500/10 px-3 py-1.5 text-xs font-semibold text-emerald-300 transition hover:border-emerald-500/80 hover:bg-emerald-500/20 focus:outline-none focus:ring focus:ring-emerald-500/40">Check aria2</button>
                      <button id="logs-refresh-btn" type="button" class="rounded-lg border border-indigo-600/60 bg-indigo-500/10 px-3 py-1.5 text-xs font-semibold text-indigo-300 transition hover:border-indigo-500/80 hover:bg-indigo-500/20 focus:outline-none focus:ring focus:ring-indigo-500/40">Refresh logs</button>
                    </div>
                  </div>
                  <div id="aria2-health" class="mb-4 hidden rounded-lg border border-slate-700/60 bg-slate-950/60 p-4 text-xs"></div>
                  <div id="logs-wrapper" class="mb-4 hidden">
                    <div class="mb-2 flex flex-wrap items-center gap-2">
                      <label class="text-xs font-medium text-slate-300">Log file:</label>
                      <select id="logs-select" class="rounded border border-slate-700 bg-slate-950 px-2 py-1 text-xs text-slate-100 focus:border-brand-400 focus:outline-none focus:ring focus:ring-brand-500/40"></select>
                      <label class="flex items-center gap-1 text-xs text-slate-300">
                        <span>Lines:</span>
                        <input id="logs-lines" type="number" min="10" max="500" value="120" class="w-20 rounded border border-slate-700 bg-slate-950 px-2 py-1 text-xs text-slate-100" />
                      </label>
                      <label class="inline-flex items-center gap-1 text-xs text-slate-300">
                        <input id="logs-auto-refresh" type="checkbox" class="h-4 w-4 rounded border-slate-600 bg-slate-800 text-brand-500 focus:ring-brand-500/60" />
                        Auto-refresh (10s)
                      </label>
                    </div>
                    <div id="logs-error" class="hidden mb-2 rounded border border-rose-500/40 bg-rose-500/10 px-3 py-2 text-xs text-rose-200"></div>
                    <pre id="logs-content" class="h-64 overflow-auto rounded-lg border border-slate-800/70 bg-slate-950/80 p-3 text-[11px] leading-tight text-slate-200"></pre>
                  </div>
                  <div id="audit-loading" class="hidden text-sm text-brand-300">Loading audit log…</div>
                  <div id="audit-error" class="hidden rounded-xl border border-rose-500/40 bg-rose-500/10 p-4 text-sm text-rose-200"></div>
                  <div id="audit-empty" class="hidden rounded-xl border border-dashed border-slate-700/60 p-8 text-center text-sm text-slate-400">No audit entries yet.</div>
                  <div class="overflow-x-auto rounded-xl border border-slate-800/60">
                    <table class="min-w-full divide-y divide-slate-800/70 text-left text-xs">
                      <thead>
                        <tr class="divide-x divide-slate-800/70 bg-slate-950/40 text-[11px] uppercase tracking-wide text-slate-400">
                          <th class="px-3 py-2">Time (relative)</th>
                          <th class="px-3 py-2">Timestamp</th>
                          <th class="px-3 py-2">User</th>
                          <th class="px-3 py-2">Action</th>
                          <th class="px-3 py-2">Subject</th>
                          <th class="px-3 py-2">Payload</th>
                        </tr>
                      </thead>
                      <tbody id="audit-table" class="divide-y divide-slate-800/70"></tbody>
                    </table>
                  </div>
                </div>
              </div>
            </section>

            <section id="settings-view" data-panel="settings" class="panel hidden">
              <div class="rounded-2xl border border-slate-800/70 bg-slate-900/60 p-6 shadow">
                <div class="mb-4 flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between">
                  <div>
                    <h3 class="text-lg font-semibold text-slate-100">System settings</h3>
                    <p class="text-sm text-slate-400">Configure URLs, download limits, and library paths.</p>
                  </div>
                </div>
                <div id="settings-error" class="hidden rounded-xl border border-rose-500/40 bg-rose-500/10 p-4 text-sm text-rose-200"></div>
                <div id="settings-loading" class="hidden text-sm text-brand-300">Loading settings…</div>
                <form id="settings-form" class="space-y-6">
                  <fieldset class="grid gap-4 rounded-2xl border border-slate-800/60 bg-slate-900/50 p-5">
                    <legend class="px-2 text-sm font-semibold uppercase tracking-wide text-slate-400">Application</legend>
                    <label class="flex flex-col gap-1 text-sm">
                      <span class="font-medium text-slate-200">Base URL</span>
                      <input id="settings-base-url" type="url" required class="rounded-lg border border-slate-800 bg-slate-950/70 px-3 py-2 text-base text-slate-100 placeholder-slate-500 focus:border-brand-400 focus:outline-none focus:ring focus:ring-brand-500/40" placeholder="http://localhost:8080" />
                    </label>
                    <div class="grid gap-4 sm:grid-cols-2">
                      <label class="flex flex-col gap-1 text-sm">
                        <span class="font-medium text-slate-200">Max active downloads</span>
                        <input id="settings-max-downloads" type="number" min="0" required class="rounded-lg border border-slate-800 bg-slate-950/70 px-3 py-2 text-base text-slate-100 focus:border-brand-400 focus:outline-none focus:ring focus:ring-brand-500/40" placeholder="2" />
                      </label>
                      <label class="flex flex-col gap-1 text-sm">
                        <span class="font-medium text-slate-200">Minimum free space (GB)</span>
                        <input id="settings-min-free-space" type="number" min="0" step="0.1" required class="rounded-lg border border-slate-800 bg-slate-950/70 px-3 py-2 text-base text-slate-100 focus:border-brand-400 focus:outline-none focus:ring focus:ring-brand-500/40" placeholder="5" />
                      </label>
                      <label class="flex flex-col gap-1 text-sm">
                        <span class="font-medium text-slate-200">Default search limit</span>
                        <input id="settings-default-search-limit" type="number" min="1" max="100" required class="rounded-lg border border-slate-800 bg-slate-950/70 px-3 py-2 text-base text-slate-100 focus:border-brand-400 focus:outline-none focus:ring focus:ring-brand-500/40" placeholder="50" />
                      </label>
                    </div>
                  </fieldset>

                  <fieldset class="grid gap-4 rounded-2xl border border-slate-800/60 bg-slate-900/50 p-5">
                    <legend class="px-2 text-sm font-semibold uppercase tracking-wide text-slate-400">Providers</legend>
                    <label class="flex flex-col gap-1 text-sm">
                      <span class="font-medium text-slate-200">Kra.sk menu cache (days)</span>
                      <input id="settings-kraska-menu-cache-ttl" type="number" min="0" step="0.1" class="rounded-lg border border-slate-800 bg-slate-950/70 px-3 py-2 text-base text-slate-100 focus:border-brand-400 focus:outline-none focus:ring focus:ring-brand-500/40" placeholder="7" />
                      <span class="text-[11px] text-slate-500">Set to 0 to disable caching for the Kra.sk menu.</span>
                    </label>
                    <label class="flex flex-col gap-1 text-sm">
                      <span class="font-medium text-slate-200">Kra.sk failure backoff (minutes)</span>
                      <input id="settings-kraska-backoff-minutes" type="number" min="1" step="0.5" class="rounded-lg border border-slate-800 bg-slate-950/70 px-3 py-2 text-base text-slate-100 focus:border-brand-400 focus:outline-none focus:ring focus:ring-brand-500/40" placeholder="5" />
                      <span class="text-[11px] text-slate-500">Pause Kra.sk jobs for this long after an invalid ident error. Defaults to 5 minutes.</span>
                    </label>
                    <label class="flex items-center gap-3 text-sm">
                      <input id="settings-kraska-debug-enabled" type="checkbox" class="rounded border-slate-600 bg-slate-800 text-brand-500 focus:ring-brand-500/60" />
                      <div class="flex flex-col gap-1">
                        <span class="font-medium text-slate-200">Enable Kra.sk debug logging</span>
                        <span class="text-[11px] text-slate-500">Logs detailed provider activity to kraska_debug.log. Credentials are automatically censored.</span>
                      </div>
                    </label>
                  </fieldset>

                  <fieldset class="grid gap-4 rounded-2xl border border-slate-800/60 bg-slate-900/50 p-5">
                    <legend class="px-2 text-sm font-semibold uppercase tracking-wide text-slate-400">Paths</legend>
                    <label class="flex flex-col gap-1 text-sm">
                      <span class="font-medium text-slate-200">Downloads directory</span>
                      <input id="settings-downloads-path" type="text" required class="rounded-lg border border-slate-800 bg-slate-950/70 px-3 py-2 text-base text-slate-100 focus:border-brand-400 focus:outline-none focus:ring focus:ring-brand-500/40" placeholder="/downloads" />
                    </label>
                    <label class="flex flex-col gap-1 text-sm">
                      <span class="font-medium text-slate-200">Library directory</span>
                      <input id="settings-library-path" type="text" required class="rounded-lg border border-slate-800 bg-slate-950/70 px-3 py-2 text-base text-slate-100 focus:border-brand-400 focus:outline-none focus:ring focus:ring-brand-500/40" placeholder="/library" />
                    </label>
                  </fieldset>

                  <fieldset class="grid gap-4 rounded-2xl border border-slate-800/60 bg-slate-900/50 p-5">
                    <legend class="px-2 text-sm font-semibold uppercase tracking-wide text-slate-400">Jellyfin</legend>
                    <label class="flex flex-col gap-1 text-sm">
                      <span class="font-medium text-slate-200">Server URL</span>
                      <input id="settings-jellyfin-url" type="url" class="rounded-lg border border-slate-800 bg-slate-950/70 px-3 py-2 text-base text-slate-100 placeholder-slate-500 focus:border-brand-400 focus:outline-none focus:ring focus:ring-brand-500/40" placeholder="http://jellyfin:8096" />
                    </label>
                    <label class="flex flex-col gap-1 text-sm">
                      <span class="font-medium text-slate-200">API key</span>
                      <input id="settings-jellyfin-api-key" type="text" class="rounded-lg border border-slate-800 bg-slate-950/70 px-3 py-2 text-base text-slate-100 placeholder-slate-500 focus:border-brand-400 focus:outline-none focus:ring focus:ring-brand-500/40" placeholder="Enter Jellyfin API key" />
                    </label>
                    <div class="grid gap-4 sm:grid-cols-[1fr_auto] items-end">
                      <label class="flex flex-col gap-1 text-sm">
                        <span class="font-medium text-slate-200">Library ID</span>
                        <input id="settings-jellyfin-library-id" type="text" class="rounded-lg border border-slate-800 bg-slate-950/70 px-3 py-2 text-base text-slate-100 placeholder-slate-500 focus:border-brand-400 focus:outline-none focus:ring focus:ring-brand-500/40" placeholder="Select or paste Jellyfin library ID" />
                      </label>
                      <button id="jellyfin-libraries-refresh" type="button" class="h-[42px] rounded-lg border border-slate-700/60 bg-slate-900/60 px-3 text-xs font-semibold text-slate-200 transition hover:border-brand-400/60 hover:text-brand-200">Fetch libraries</button>
                    </div>
                    <div id="jellyfin-libraries-wrapper" class="hidden space-y-2 rounded-lg border border-slate-800/60 bg-slate-950/40 p-3">
                      <div class="flex items-center justify-between">
                        <span class="text-xs font-semibold uppercase tracking-wide text-slate-400">Available libraries</span>
                        <button type="button" id="jellyfin-libraries-hide" class="text-[10px] font-medium uppercase tracking-wide text-slate-400 hover:text-slate-200">Hide</button>
                      </div>
                      <div id="jellyfin-libraries-loading" class="hidden text-xs text-brand-300">Loading Jellyfin libraries…</div>
                      <div id="jellyfin-libraries-error" class="hidden rounded border border-rose-500/40 bg-rose-500/10 p-2 text-[11px] text-rose-200"></div>
                      <select id="jellyfin-libraries-select" size="5" class="w-full rounded-md border border-slate-700/70 bg-slate-950/60 p-2 text-sm text-slate-100"></select>
                      <p class="text-[11px] text-slate-500">Select a library to set its ID. Only that library will be refreshed on new or deleted media.</p>
                    </div>
                  </fieldset>

                  <div class="flex justify-end">
                    <button id="settings-save-btn" type="submit" class="rounded-lg bg-brand-500 px-4 py-2 text-sm font-semibold text-white shadow transition hover:bg-brand-400 focus:outline-none focus:ring focus:ring-brand-500/40">Save changes</button>
                  </div>
                </form>
              </div>
            </section>

            <section id="users-view" data-panel="users" class="panel hidden">
              <div class="rounded-2xl border border-slate-800/70 bg-slate-900/60 p-6 shadow">
                <div class="mb-4 flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between">
                  <div>
                    <h3 class="text-lg font-semibold text-slate-100">Users</h3>
                    <p class="text-sm text-slate-400">Invite teammates and manage roles.</p>
                  </div>
                  <button id="user-create-btn" type="button" class="rounded-lg bg-brand-500 px-4 py-2 text-sm font-semibold text-white shadow transition hover:bg-brand-400 focus:outline-none focus:ring focus:ring-brand-500/40">New user</button>
                </div>
                <div id="users-error" class="hidden rounded-xl border border-rose-500/40 bg-rose-500/10 p-4 text-sm text-rose-200"></div>
                <table class="min-w-full overflow-hidden rounded-xl border border-slate-800/70 bg-slate-900/40 text-sm">
                  <thead class="bg-slate-900/80 text-left text-xs uppercase tracking-wide text-slate-400">
                    <tr>
                      <th class="px-4 py-3">Name</th>
                      <th class="px-4 py-3">Email</th>
                      <th class="px-4 py-3">Role</th>
                      <th class="px-4 py-3">Created</th>
                      <th class="px-4 py-3">Actions</th>
                    </tr>
                  </thead>
                  <tbody id="users-table" class="divide-y divide-slate-800/70"></tbody>
                </table>
                <div id="users-empty" class="hidden rounded-xl border border-dashed border-slate-700/60 p-8 text-center text-sm text-slate-400">Loading users…</div>
              </div>
            </section>

            <section id="audit-view" data-panel="audit" class="panel hidden">
              <div class="rounded-2xl border border-slate-800/70 bg-slate-900/60 p-6 shadow">
                <div class="mb-4 flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between">
                  <div>
                    <h3 class="text-lg font-semibold text-slate-100">Audit log</h3>
                    <p class="text-sm text-slate-400">Latest actions across the system.</p>
                  </div>
                  <button id="audit-refresh-btn" type="button" class="rounded-lg border border-slate-700/60 bg-slate-950/60 px-3 py-1.5 text-xs font-semibold text-slate-200 transition hover:border-brand-400/60 hover:text-brand-200">Refresh</button>
                </div>
                <div id="audit-error" class="hidden rounded-xl border border-rose-500/40 bg-rose-500/10 p-4 text-sm text-rose-200"></div>
                <div id="audit-empty" class="hidden rounded-xl border border-dashed border-slate-700/60 p-8 text-center text-sm text-slate-400">No audit entries yet.</div>
                <div class="overflow-hidden rounded-xl border border-slate-800/70 bg-slate-900/40">
                  <table class="min-w-full text-sm">
                    <thead class="bg-slate-900/80 text-left text-xs uppercase tracking-wide text-slate-400">
                      <tr>
                        <th class="px-4 py-3">When</th>
                        <th class="px-4 py-3">Actor</th>
                        <th class="px-4 py-3">Action</th>
                        <th class="px-4 py-3">Subject</th>
                        <th class="px-4 py-3">Details</th>
                      </tr>
                    </thead>
                    <tbody id="audit-table" class="divide-y divide-slate-800/70"></tbody>
                  </table>
                </div>
                <div class="mt-4 flex items-center justify-between">
                  <button id="audit-load-more" type="button" class="rounded-lg border border-slate-700/60 bg-slate-950/60 px-3 py-1.5 text-xs font-semibold text-slate-200 transition hover:border-brand-400/60 hover:text-brand-200">Load older</button>
                  <div id="audit-loading" class="hidden text-xs text-brand-300">Loading audit entries…</div>
                </div>
              </div>
            </section>
          </div>

          <aside class="space-y-6">
            <section class="rounded-2xl border border-slate-800/70 bg-slate-900/60 p-6 shadow">
              <div class="mb-4 flex items-center justify-between">
                <h3 class="text-lg font-semibold text-slate-100">Storage</h3>
                <button id="storage-refresh-btn" type="button" class="rounded-full border border-slate-800/60 bg-slate-950/60 px-3 py-1 text-xs font-medium text-slate-300 transition hover:border-brand-400/60 hover:text-brand-200">Refresh</button>
              </div>
              <div id="storage-loading" class="hidden text-sm text-brand-300">Measuring disks…</div>
              <div id="storage-error" class="hidden rounded-lg border border-rose-500/40 bg-rose-500/10 p-3 text-sm text-rose-200"></div>
              <div id="storage-mounts" class="space-y-4"></div>
            </section>
            <section class="rounded-2xl border border-slate-800/70 bg-slate-900/60 p-6 shadow">
              <div class="mb-4 flex items-center justify-between">
                <h3 class="text-lg font-semibold text-slate-100">Queue Stats</h3>
                <button id="stats-refresh-btn" type="button" class="rounded-full border border-slate-800/60 bg-slate-950/60 px-3 py-1 text-xs font-medium text-slate-300 transition hover:border-brand-400/60 hover:text-brand-200">Refresh</button>
              </div>
              <div id="stats-loading" class="hidden text-sm text-brand-300">Computing stats…</div>
              <div id="stats-error" class="hidden rounded-lg border border-rose-500/40 bg-rose-500/10 p-3 text-sm text-rose-200"></div>
              <div id="stats-content" class="space-y-4"></div>
              <div id="stats-meta" class="mt-4 text-[10px] uppercase tracking-wide text-slate-500"></div>
            </section>
          </aside>
        </div>
      </section>
    </div>
    <div id="toast-container" class="pointer-events-none fixed top-4 right-4 z-50 flex w-full max-w-sm flex-col gap-3"></div>
    <dialog id="modal" class="modal"></dialog>
  </body>
</html>
